#!/usr/bin/env php
<?php

$autoloadCandidates = [
    __DIR__ . '/../../vendor/autoload.php',       // local dev: src/bin/mononoke
    __DIR__ . '/../../../../autoload.php',        // installed: vendor/kekke/mononoke/src/bin/mononoke
];

$autoload = null;
foreach ($autoloadCandidates as $file) {
    if (file_exists($file)) {
        $autoload = require $file;
        break;
    }
}

if ($autoload === null) {
    fwrite(STDERR, "Could not find autoload.php\n");
    exit(1);
}

use Kekke\Mononoke\Framework;

// Remove the binary name
$args = $_SERVER['argv'];
array_shift($args);

// First argument should be the service file
$serviceFile = array_shift($args);

if (!$serviceFile || !file_exists($serviceFile)) {
    fwrite(STDERR, "Usage: mononoke <service_file.php> [--flags]\n");
    exit(1);
}

Framework::run($serviceFile, $args);